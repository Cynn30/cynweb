<!DOCTYPE html>
<html lang="zh-CN" >
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cyn's 树洞站 - 登录 / 注册</title>
  <style>
    * {
      box-sizing: border-box;
    }
    body, html {
      margin: 0; padding: 0;
      height: 100%;
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background: #e6f0f7;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
    }
    .container {
      display: flex;
      width: 900px;
      max-width: 95vw;
      height: 600px;
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.15);
      overflow: hidden;
      background: white;
      user-select: none;
    }
    .welcome-section {
      flex: 1.4;
      background-image: url("https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=800&q=80");
      background-size: cover;
      background-position: center;
      position: relative;
      color: #e6f0f7;
      display: flex;
      flex-direction: column;
      justify-content: center;
      padding: 40px 30px;
      text-shadow: 0 0 10px rgba(0,0,0,0.6);
    }
    .welcome-section h1 {
      font-size: 2.8rem;
      margin-bottom: 12px;
      font-weight: 900;
    }
    .welcome-section p {
      font-size: 1.1rem;
      line-height: 1.5;
      font-weight: 500;
      max-width: 280px;
      opacity: 0.9;
    }
    .form-section {
      flex: 1;
      background: #f4f9ff;
      padding: 50px 38px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      position: relative;
    }
    .form-section h2 {
      margin: 0 0 30px 0;
      color: #4a90e2;
      font-weight: 800;
      font-size: 2rem;
      text-align: center;
    }
    label {
      display: block;
      margin-bottom: 6px;
      font-weight: 600;
      color: #4a90e2;
      font-size: 0.95rem;
    }
    input[type="text"], input[type="password"] {
      width: 100%;
      padding: 12px 16px;
      margin-bottom: 22px;
      border: 2px solid #a9c0e0;
      border-radius: 14px;
      font-size: 1rem;
      font-family: inherit;
      color: #2f3e4d;
      background: #f8fbff;
      transition: border-color 0.3s ease, box-shadow 0.3s ease;
    }
    input[type="text"]:focus, input[type="password"]:focus {
      border-color: #4a90e2;
      box-shadow: 0 0 8px rgba(74, 144, 226, 0.5);
      outline: none;
      background: white;
    }
    button {
      background-color: #4a90e2;
      border: none;
      color: #e6f0f7;
      font-weight: 700;
      font-size: 1.1rem;
      padding: 14px 0;
      border-radius: 18px;
      cursor: pointer;
      box-shadow: 0 3px 6px rgba(74, 144, 226, 0.5);
      transition: background-color 0.25s ease, box-shadow 0.25s ease;
      user-select: none;
      margin-top: 10px;
      width: 100%;
    }
    button:hover, button:focus {
      background-color: #2e66c7;
      box-shadow: 0 6px 14px rgba(46, 102, 199, 0.8);
      outline: none;
    }
    .toggle-text {
      margin-top: 18px;
      font-size: 0.9rem;
      color: #4a90e2;
      text-align: center;
      cursor: pointer;
      user-select: none;
      transition: color 0.3s ease;
    }
    .toggle-text:hover {
      color: #2e66c7;
      text-decoration: underline;
    }
    .error-msg {
      color: #d94f4f;
      font-weight: 700;
      margin-bottom: 16px;
      text-align: center;
      min-height: 20px;
      user-select: none;
    }
    @media (max-width: 750px) {
      .container {
        flex-direction: column;
        height: auto;
      }
      .welcome-section {
        flex: none;
        height: 240px;
        border-radius: 20px 20px 0 0;
        text-align: center;
        padding: 30px 24px;
      }
      .form-section {
        flex: none;
        padding: 32px 24px 48px;
        border-radius: 0 0 20px 20px;
      }
    }
  </style>
</head>
<body>

<div class="container" role="main" aria-label="登录和注册界面">
  <section class="welcome-section" aria-label="欢迎区域">
    <h1>欢迎来到 Cyn's 树洞</h1>
    <p>在这里，你可以写下心声，秘密安全保存。<br>现在，先登录或者创建你的账号开始吧！</p>
  </section>

  <section class="form-section" aria-label="账号操作区域">
    <h2 id="formTitle">登录</h2>
    <div class="error-msg" id="errorMsg" aria-live="assertive"></div>
    <form id="authForm" novalidate>
      <label for="usernameInput">用户名</label>
      <input type="text" id="usernameInput" name="username" autocomplete="username" required aria-required="true" aria-describedby="usernameHelp" />
      <label for="passwordInput">密码</label>
      <input type="password" id="passwordInput" name="password" autocomplete="current-password" required aria-required="true" />
      <button type="submit" id="submitBtn">登录</button>
    </form>
    <div class="toggle-text" id="toggleMode" role="button" tabindex="0" aria-pressed="false" aria-label="切换注册和登录">
      还没有账号？点击注册
    </div>
  </section>
</div>

<script>
  // 本地存储账户（注意：仅示范，非安全方案）
  // 账户结构： { username: string, password: string }
  const STORAGE_KEY = 'treehole_users';
  let users = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');

  const authForm = document.getElementById('authForm');
  const usernameInput = document.getElementById('usernameInput');
  const passwordInput = document.getElementById('passwordInput');
  const errorMsg = document.getElementById('errorMsg');
  const formTitle = document.getElementById('formTitle');
  const submitBtn = document.getElementById('submitBtn');
  const toggleModeBtn = document.getElementById('toggleMode');

  let isLoginMode = true;

  function setError(msg) {
    errorMsg.textContent = msg;
  }

  function clearError() {
    errorMsg.textContent = '';
  }

  function saveUsers() {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(users));
  }

  function validateUsername(username) {
    return /^[a-zA-Z0-9_-]{3,16}$/.test(username);
  }

  function validatePassword(password) {
    return password.length >= 6;
  }

  authForm.addEventListener('submit', e => {
    e.preventDefault();
    clearError();
    const username = usernameInput.value.trim();
    const password = passwordInput.value;

    if (!validateUsername(username)) {
      setError('用户名需3-16位，只允许字母数字、下划线和短横线');
      return;
    }
    if (!validatePassword(password)) {
      setError('密码至少6位');
      return;
    }

    if (isLoginMode) {
      // 登录逻辑
      const foundUser = users.find(u => u.username === username);
      if (!foundUser) {
        setError('用户不存在');
        return;
      }
      if (foundUser.password !== password) {
        setError('密码错误');
        return;
      }
      // 登录成功
      clearError();
      alert(`登录成功，欢迎回来 ${username}！`);
      // 跳转或加载主页面（示例，替换成你需要的逻辑）
      window.location.reload();
    } else {
      // 注册逻辑
      if (users.some(u => u.username === username)) {
        setError('用户名已存在');
        return;
      }
      users.push({ username, password });
      saveUsers();
      clearError();
      alert('注册成功，请登录');
      toggleMode(); // 自动切换回登录
    }
  });

  function toggleMode() {
    isLoginMode = !isLoginMode;
    clearError();
    if (isLoginMode) {
      formTitle.textContent = '登录';
      submitBtn.textContent = '登录';
      toggleModeBtn.textContent = '还没有账号？点击注册';
      passwordInput.setAttribute('autocomplete', 'current-password');
    } else {
      formTitle.textContent = '注册';
      submitBtn.textContent = '注册';
      toggleModeBtn.textContent = '已有账号？点击登录';
      passwordInput.setAttribute('autocomplete', 'new-password');
    }
    usernameInput.value = '';
    passwordInput.value = '';
    usernameInput.focus();
    toggleModeBtn.setAttribute('aria-pressed', !isLoginMode);
  }

  toggleModeBtn.addEventListener('click', toggleMode);
  toggleModeBtn.addEventListener('keydown', e => {
    if (e.key === 'Enter' || e.key === ' ') {
      e.preventDefault();
      toggleMode();
    }
  });
</script>

</body>
</html>
